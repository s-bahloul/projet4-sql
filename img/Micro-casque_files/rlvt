!function(){"use strict";var e,t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},n=function(e,t){var n="000000000"+e;return n.substr(n.length-t)},r="object"==typeof window?window:self,i=Object.keys(r).length,o=navigator.mimeTypes?navigator.mimeTypes.length:0,s=n((o+navigator.userAgent.length).toString(36)+i.toString(36),4),a=function(){return s},u="undefined"!=typeof window&&(window.crypto||window.msCrypto)||"undefined"!=typeof self&&self.crypto;if(u){var l=Math.pow(2,32)-1;e=function(){return Math.abs(u.getRandomValues(new Uint32Array(1))[0]/l)}}else e=Math.random;var d=e,c=0,f=Math.pow(36,4);function p(){return n((d()*f<<0).toString(36),4)}function v(){return c=c<f?c:0,++c-1}function h(){return"c"+(new Date).getTime().toString(36)+n(v().toString(36),4)+a()+(p()+p())}h.slug=function(){var e=(new Date).getTime().toString(36),t=v().toString(36).slice(-4),n=a().slice(0,1)+a().slice(-1),r=p().slice(-2);return e.slice(-2)+t+n+r},h.isCuid=function(e){return"string"==typeof e&&!!e.startsWith("c")},h.isSlug=function(e){if("string"!=typeof e)return!1;var t=e.length;return t>=7&&t<=10},h.fingerprint=a;var g=h;var y,m=(function(e,t){var n;n=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function i(){}function o(t,n,o){if("undefined"!=typeof document){"number"==typeof(o=e({path:"/"},i.defaults,o)).expires&&(o.expires=new Date(1*new Date+864e5*o.expires)),o.expires=o.expires?o.expires.toUTCString():"";try{var s=JSON.stringify(n);/^[\{\[]/.test(s)&&(n=s)}catch(e){}n=r.write?r.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var u in o)o[u]&&(a+="; "+u,!0!==o[u]&&(a+="="+o[u].split(";")[0]));return document.cookie=t+"="+n+a}}function s(e,n){if("undefined"!=typeof document){for(var i={},o=document.cookie?document.cookie.split("; "):[],s=0;s<o.length;s++){var a=o[s].split("="),u=a.slice(1).join("=");n||'"'!==u.charAt(0)||(u=u.slice(1,-1));try{var l=t(a[0]);if(u=(r.read||r)(u,l)||t(u),n)try{u=JSON.parse(u)}catch(e){}if(i[l]=u,e===l)break}catch(e){}}return e?i[e]:i}}return i.set=o,i.get=function(e){return s(e,!1)},i.getJSON=function(e){return s(e,!0)},i.remove=function(t,n){o(t,"",e(n,{expires:-1}))},i.defaults={},i.withConverter=n,i}((function(){}))},e.exports=n()}(y={exports:{}},y.exports),y.exports),I="rlvt_tmpId",w="rlvt_id",b="rlvt_clientId",S="rlvt_b",C="rlvt_fail_queue",R=function(){function e(e,t,n,r){this.companyId=e,this.domain=t,this.currentUrl=n,this.destinationUrl=r,this.initUser(),this.initSourceIdentifier(),this.startEmptyingFailQueue()}return e.prototype.event=function(e,t){var n=this,r=t;setTimeout((function(){if("identify"===e){if(!1===n.isClientIdValid(t))return;n.storeClientId(String(r)),r={}}var i=n.buildEvent(e,r);if(null!==i)return n.sendEvent(i)}))},e.prototype.identify=function(e){return!1===this.isClientIdValid(e)?console.error("Reelevant error: Failed to publish identify: clientId is empty",{clientId:e}):this.event("identify",e)},e.prototype.storeClientId=function(e){this.user.clientId=String(e),m.set(b,this.user.clientId,{expires:30,domain:this.domain})},e.prototype.isClientIdValid=function(e){return"string"==typeof e&&0!==e.length&&["undefined","null","inconnu","unknown","0","-1","NaN","ko","true","false","Infinity","-Infinity","{}","[]"].every((function(t){return e!==t}))},e.prototype.initUser=function(){var e,t=m.get(I);this.user={tmpId:null!=t?t:g()},void 0===t&&m.set(I,this.user.tmpId,{expires:30,domain:this.domain});var n=new URLSearchParams(this.currentUrl.search);this.user.rlvtId=null!==(e=n.get(w))&&void 0!==e?e:m.get(w),this.user.rlvtId&&m.set(w,this.user.rlvtId,{expires:30,domain:this.domain});var r=m.get(b);this.isClientIdValid(r)&&(this.user.clientId=m.get(b));var i=window.reelevant_user;this.isClientIdValid(i)&&this.storeClientId(i);var o=n.get("rlvt-u")||n.get("uid");this.isClientIdValid(o)&&this.storeClientId(o)},e.prototype.initSourceIdentifier=function(){var e=new URLSearchParams(this.currentUrl.search).get(S);this.sourceIdentifier=null!=e?e:m.get(S),e&&m.set(S,this.sourceIdentifier,{expires:30,domain:this.domain})},e.prototype.buildEvent=function(e,t){if(void 0===t&&(t={}),!e)return console.error("Reelevant error: Name is required to send event"),null;if("object"!=typeof t||null===t||Array.isArray(t))return console.error("Reelevant error: Data must be an object",{data:t,name:e}),null;var n;try{n=JSON.parse(JSON.stringify(t))}catch(n){return console.error("Reelevant error: Unable to build data",{data:t,name:e}),null}return void 0!==n.ids&&"string"!=typeof n.ids&&!1===Array.isArray(n.ids)?(console.error("Reelevant error: Unable to build data, ids must be a string or an array of strings",n),null):("string"==typeof n.ids&&(n.ids.includes(";")||n.ids.includes(",")||n.ids.includes("|"))&&console.warn("Reelevant warning: ids should be an array if you have more than 1 product id",n),void 0!==n.value&&"string"!=typeof n.value&&"number"!=typeof n.value?(console.error("Reelevant error: Unable to build data, value must be a string or a number",n),null):("string"==typeof n.value&&(n.value.includes(";")||n.value.includes(",")||n.value.includes("|"))&&console.warn("Reelevant warning: value should be the total value if you have multiple products",n),{key:this.companyId,name:e,url:this.currentUrl.href,id:this.user.rlvtId,b:this.sourceIdentifier,tmpId:this.user.tmpId,clientId:this.user.clientId,data:n,eventId:g(),v:1}))},e.prototype.sendEvent=function(e){var t=this,n=new XMLHttpRequest;n.open("POST",this.destinationUrl,!0),n.setRequestHeader("content-type","application/json"),n.send(JSON.stringify(e)),n.onerror=function(){t.addToFailQueue(e)},n.onload=function(){n.status>=500&&t.addToFailQueue(e)}},e.prototype.getFailQueue=function(){var e=localStorage.getItem(C);return null===e?[]:JSON.parse(e)},e.prototype.saveFailQueue=function(e){localStorage.setItem(C,JSON.stringify(e))},e.prototype.addToFailQueue=function(e){var n=this.getFailQueue();n.push(t({timestamp:Date.now()},e)),this.saveFailQueue(n)},e.prototype.startEmptyingFailQueue=function(){var e=this,t=function(){var t=e.getFailQueue(),n=t.shift();void 0!==n&&(e.saveFailQueue(t),e.sendEvent(n))};t(),setInterval(t,15e3)},e}();!function(e){var t,n;if(!(null===(t=e.reel)||void 0===t?void 0:t.companyId))return console.error("Reelevant error: Missing key");if(!(null===(n=e.reel)||void 0===n?void 0:n.datasourceId))return console.error("Reelevant error: Missing datasource");var r=e.location.host,i=r.split("."),o=[".co.uk"].includes(r.substr(r.length-6))?3:2,s=i.slice(i.length-o).join("."),a=new R(e.reel.companyId,"."+(["myshopify.com"].some((function(t){return e.location.host.includes(t)}))?e.location.host:s),e.location,"https://collector.reelevant.com/collect/{datasourceId}/rlvt".replace(/{datasourceId}/g,e.reel.datasourceId));e.reel.event=a.event.bind(a),e.reel.identify=a.identify.bind(a),e.reel.queue||(e.reel.queue=[]),setInterval((function(){var t,n,r=(null!==(n=null===(t=e.reel)||void 0===t?void 0:t.queue)&&void 0!==n?n:[]).shift();r&&a.event.apply(a,r)}),1)}(window)}();
